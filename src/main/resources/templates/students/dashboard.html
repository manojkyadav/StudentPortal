<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Student Dashboard</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" th:href="@{/css/style.css}">
	<script src="https://unpkg.com/feather-icons"></script>
</head>

<body>

	<div class="dashboard-layout">

		<!-- Sidebar -->
		<div th:replace="fragments/sidebar :: sidebarFragment"></div>

		<!-- Main Content -->
		<main class="main-content">

			<!-- Header -->
			<div class="page-header">
				<h1 class="page-title">Welcome, <span th:text="${session.USER_NAME}">User Name</span>!</h1>
				<p class="page-subtitle">Track your learning progress</p>
			</div>

			<!-- Stats -->
			<div class="card-grid">

				<div class="stat-card">
					<div class="stat-icon" style="background:#e0e7ff;">
						<i data-feather="check-circle" style="color:#667eea"></i>
					</div>
					<div class="stat-value" th:text="${stats.testsCompleted}"></div>
					<div class="stat-label">Tests Completed</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon" style="background:#d1fae5;">
						<i data-feather="percent" style="color:#38a169"></i>
					</div>
					<div class="stat-value" th:text="${#numbers.formatDecimal(stats.averageScore,1,2)} + '%'">
					</div>
					<div class="stat-label">Average Score</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon" style="background:#fff7ed;">
						<i data-feather="book-open" style="color:#ed8936"></i>
					</div>
					<div class="stat-value" th:text="${stats.topicsStudied}"></div>
					<div class="stat-label">Topics Studied</div>
				</div>

			</div>

			<!--div th:each="tp : ${topicPerformance}" class="chart-container">
						    <div class="chart-title" th:text="${tp.topicName}"></div>
							<div style="margin-top:2rem;">

						    <div style="margin-bottom:0.5rem; font-weight:600; overflow:hidden;">
								<div style="background:#e2e8f0; border-radius:12px; overflow:hidden;">
									<div style="
									width:100%;
									padding:0.75rem;
									background:linear-gradient(135deg,#667eea,#764ba2);
									color:white;
									text-align:center;
									font-weight:600;
								                    ">
						            Score:
						            <span th:text="${#numbers.formatDecimal(tp.averageScore,1,2)}"></span>%
						        </div>
						    </div>
							</div>
							</div>
						</div-->
			<div class="chart-container professional-chart">
				<div class="chart-header">
					<h2 class="chart-title">Topic Performance</h2>
					<span class="chart-subtitle">Average score (%)</span>
				</div>

				<div class="chart-area">
					<!-- Y-axis labels -->
					<div class="y-axis">
						<span>100</span>
						<span>75</span>
						<span>50</span>
						<span>25</span>
						<span>0</span>
					</div>

					<!-- Bars -->
					<div class="bars">
						<div th:each="tp : ${topicPerformance}" class="bar-group">

							<div class="bar-container">
								<div class="bar" th:style="'height:' + ${tp.averageScore} + '%'">

									<span class="bar-topic"
										th:text="${tp.topicName.length() > 20} ? ${tp.topicName.substring(0,20)} + 'â€¦' : ${tp.topicName}">
									</span>

									<span class="bar-value"
										th:text="${#numbers.formatDecimal(tp.averageScore,0,0)} + '%'">
									</span>
								</div>
							</div>

							<!--div class="bar-label"
						                     th:text="${tp.topicName}">
						                </div-->
						</div>
					</div>
				</div>
			</div>


			<!-- Recent Activity -->
			<div class="table-container">
				<div class="table-header">
					<h2 class="table-title">Recent Activity</h2>
				</div>

				<table>
					<thead>
						<tr>
							<th>Topic</th>
							<th>Mode</th>
							<th>Score</th>
							<th>Date</th>
						</tr>
					</thead>

					<tbody>
						<tr th:each="ra : ${recentActivities}">
							<td th:text="${ra.topicName}"></td>
							<td>
								<span class="badge badge-info"
									th:classappend="${ra.mode == 'EXAM'} ? 'badge-info' : 'badge-warning'"
									th:text="${ra.mode}">
								</span>
							</td>
							<td>
								<span class="badge badge-success"
									th:text="${#numbers.formatDecimal(ra.score,1,2)} + '%'">
								</span>
							</td>
							<td th:text="${#temporals.format(ra.completedAt,'dd/MM/yyyy')}"></td>
						</tr>

					</tbody>
				</table>
			</div>

		</main>
	</div>

	<script>
		feather.replace();
	</script>

</body>

</html>